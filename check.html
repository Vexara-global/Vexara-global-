<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Check Your Contract ‚Äî Vexara Global</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <div class="container">
      <div style="display: flex; align-items: center; gap: 12px;">
        <div class="logo">Vexara Global</div>
        <button class="theme-toggle" id="themeToggle">‚òÄÔ∏è</button>
      </div>
      <div class="menu-toggle" id="menuToggle">
        <span></span><span></span><span></span>
      </div>
      <ul class="nav-menu" id="navMenu">
        <li><a href="index.html">Home</a></li>
        <li><a href="check.html">Check My Contract</a></li>
        <li><a href="index.html#contact">Contact</a></li>
      </ul>
    </div>
  </header>

  <main class="container">
    <section class="hero check-hero">
      <div class="check-card">
        <h1>Check Your Contract Status</h1>
        <p>Enter the unique reference you received after submitting your request.</p>

        <form id="checkForm" class="check-form">
          <input type="text" id="reference" placeholder="Contract Reference (e.g. VX-2026-789)" required />
          <button type="submit" class="btn primary">Verify</button>
        </form>

        <div id="result" class="result-box"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      &copy; 2026 Vexara Global
    </div>
  </footer>

  <script>
  document.getElementById('checkForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const ref = document.getElementById('reference').value.trim().toUpperCase();
    const resultDiv = document.getElementById('result');
    
    if (!ref) {
      resultDiv.innerHTML = '<p style="color:#ef4444;">Please enter a reference.</p>';
      return;
    }

    resultDiv.innerHTML = '<p style="color:#94a3b8;">Checking...</p>';

    try {
      const response = await fetch(`/.netlify/functions/check-application?ref=${encodeURIComponent(ref)}`);
      const data = await response.json();

      if (response.ok) {
        // D√©termine l'ic√¥ne et le texte du statut
        let statusIcon, statusText, statusColor;
        if (data.status === 'validated') {
          statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="#10b981" stroke-width="2"/></svg>';
          statusText = 'Confirmed';
          statusColor = '#10b981';
        } else if (data.status === 'pending') {
          statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" stroke="#f59e0b" stroke-width="2"/></svg>';
          statusText = 'Pending';
          statusColor = '#f59e0b';
        } else {
          statusIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 18L18 6M6 6l12 12" stroke="#ef4444" stroke-width="2"/></svg>';
          statusText = data.status.charAt(0).toUpperCase() + data.status.slice(1);
          statusColor = '#ef4444';
        }

        // Formatte le type
        const formattedType = data.type
          .split('-')
          .map(word => word.charAt(0).toUpperCase() + word.slice(1))
          .join(' ');

        resultDiv.innerHTML = `
          <div style="
            margin-top: 30px;
            padding: 24px;
            background: #052e16;
            border-radius: 16px;
            border-left: 4px solid ${statusColor};
            color: #f1f5f9;
            font-size: 1.05rem;
            line-height: 1.6;          ">
            <h3 style="margin: 0 0 16px 0; color: ${statusColor}; font-size: 1.4rem;">Contract Found</h3>
            <p><strong>Reference:</strong> ${data.reference}</p>
            <p><strong>Full Name:</strong> ${data.fullName}</p>
            <p><strong>Category:</strong> ${data.category}</p>
            <p><strong>Type:</strong> ${formattedType}</p>
            <p><strong>Status:</strong> <span style="display: inline-flex; align-items: center; gap: 8px;">${statusIcon} ${statusText}</span></p>
          </div>
        `;
      } else {
        resultDiv.innerHTML = `
          <div style="
            margin-top: 30px;
            padding: 24px;
            background: #450a0a;
            border-radius: 16px;
            border-left: 4px solid #ef4444;
            color: #fca5a5;
            font-size: 1.05rem;
            line-height: 1.6;
          ">
            <h3 style="margin: 0 0 16px 0; color: #f87171; font-size: 1.4rem;">Reference Not Found</h3>
            <p>Please double-check your reference code.</p>
            <p>Still missing it? <a href="index.html#contact" style="color:#f87171; text-decoration:underline;">Contact us</a>.</p>
          </div>
        `;
      }
    } catch (err) {
      console.error(err);
      resultDiv.innerHTML = `<p style="color:#ef4444; margin-top:16px;">Network error. Please try again.</p>`;
    }
  });

  // Theme toggle + menu mobile (si pas d√©j√† inclus)
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('themeToggle');
    if (toggle) {
      const saved = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', saved);
      toggle.textContent = saved === 'dark' ? 'üåô' : '‚òÄÔ∏è';
      toggle.addEventListener('click', () => {
        const newTheme = saved === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        toggle.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
      });
    }

    const menuToggle = document.getElementById('menuToggle');
    const navMenu = document.getElementById('navMenu');    if (menuToggle && navMenu) {
      menuToggle.addEventListener('click', () => navMenu.classList.toggle('active'));
    }
    });
  </script>
</body>
</html>
