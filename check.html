<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Check Your Contract ‚Äî Vexara Global</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <div class="container">
      <div style="display: flex; align-items: center; gap: 12px;">
        <div class="logo">Vexara Global</div>
        <button class="theme-toggle" id="themeToggle">‚òÄÔ∏è</button>
      </div>
      <div class="menu-toggle" id="menuToggle">
        <span></span><span></span><span></span>
      </div>
      <ul class="nav-menu" id="navMenu">
        <li><a href="index.html">Home</a></li>
        <li><a href="check.html">Check My Contract</a></li>
        <li><a href="index.html#contact">Contact</a></li>
      </ul>
    </div>
  </header>

  <main class="container">
    <section class="hero check-hero">
      <div class="check-card">
        <h1>Check Your Contract Status</h1>
        <p>Enter the unique reference you received after submitting your request.</p>

        <form id="checkForm" class="check-form">
          <input type="text" id="reference" placeholder="Contract Reference (e.g. VX-2026-789)" required />
          <button type="submit" class="btn primary">Verify</button>
        </form>

        <div id="result" class="result-box"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      &copy; 2026 Vexara Global
    </div>
  </footer>

  <script>
    document.getElementById('checkForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const ref = document.getElementById('reference').value.trim().toUpperCase();
      const resultDiv = document.getElementById('result');
      
      if (!ref) {
        resultDiv.innerHTML = '<p class="error">Please enter a reference.</p>';
        return;
      }

      resultDiv.innerHTML = '<p style="color:var(--gray);">Checking...</p>';

      try {
        const response = await fetch(`/.netlify/functions/check-application?ref=${encodeURIComponent(ref)}`);
        const data = await response.json();

        if (response.ok) {
          let statusText = '';
          if (data.status === 'validated') statusText = '‚úÖ Confirmed';
          else if (data.status === 'pending') statusText = '‚è≥ Pending';
          else if (data.status === 'expired') statusText = '‚ùå Expired';
          else statusText = data.status;

          resultDiv.innerHTML = `
            <div class="status-success">
              <strong>Contract Found</strong><br>
              Reference: ${data.reference}<br>
              Type: ${data.type}<br>
              Status: ${statusText}
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="status-error">
              <strong>‚ùå Reference Not Found</strong><br>
              Double-check your code.<br>
              Still missing it? <a href="index.html#contact">Contact us</a>.
            </div>
          `;
        }
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = `<p class="error">Network error. Please try again.</p>`;
      }
    });

    // Theme toggle
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById('themeToggle');
      if (toggle) {
        const saved = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', saved);
        toggle.textContent = saved === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        toggle.addEventListener('click', () => {
          const newTheme = saved === 'dark' ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          toggle.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        });
      }

      // Mobile menu
      const menuToggle = document.getElementById('menuToggle');
      const navMenu = document.getElementById('navMenu');
      if (menuToggle && navMenu) {
        menuToggle.addEventListener('click', () => navMenu.classList.toggle('active'));
      }
    });
  </script>
</body>
</html>
