<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="robots" content="noindex, nofollow" />
  <title>Admin ‚Äî Vexara Global</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header>
    <div class="container">
      <div style="display: flex; align-items: center; gap: 12px;">
        <div class="logo">üîí Admin Panel</div>
        <button class="theme-toggle" id="themeToggle">‚òÄÔ∏è</button>
      </div>
    </div>
  </header>

  <main class="container" style="padding: 40px 0;">
    <div id="login-screen">
      <h2>Admin Login</h2>
      <form id="loginForm" style="max-width: 400px; margin: 20px auto;">
        <input type="password" id="adminPass" placeholder="Password" required style="width:100%; padding:12px; margin:10px 0; border:1px solid var(--border-color); border-radius:6px;" />
        <button type="submit" class="btn">Login</button>
        <p id="login-error" style="color:var(--error); margin-top:10px; display:none;">Invalid password</p>
      </form>
    </div>

    <div id="admin-panel" style="display:none;">
      <h2>Create New Contract Reference</h2>
      <form id="contractForm" style="max-width: 600px; margin: 20px auto;">
        <input type="text" id="clientName" placeholder="Client Full Name *" required />
        <input type="email" id="clientEmail" placeholder="Client Email *" required />
        <select id="requestType" required>
          <option value="">-- Type *</option>
          <option value="job">Job</option>
          <option value="internship">Internship</option>
          <option value="language-stay">Language Stay</option>
        </select>
        <select id="status" required>
          <option value="pending">En attente</option>
          <option value="validated">Valid√©</option>
          <option value="expired">Expir√©</option>
        </select>
        <div class="file-upload">
          <label class="file-label">
            <span>üìÑ Upload Contract (PDF)</span>
            <input type="file" id="contractFile" accept=".pdf" required />
          </label>          <div id="contract-preview" style="margin-top:8px;font-size:0.9rem;color:var(--gray);"></div>
        </div>
        <button type="submit" class="btn primary">Generate Reference</button>
      </form>

      <div id="result" style="margin-top: 30px; padding: 15px; border-radius: 8px;"></div>
    </div>
  </main>

  <script>
    // Simple login (password from env)
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const pass = document.getElementById('adminPass').value;
      const res = await fetch('/.netlify/functions/auth', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: pass })
      });
      if (res.ok) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
      } else {
        document.getElementById('login-error').style.display = 'block';
      }
    });

    // File preview for contract
    document.getElementById('contractFile').addEventListener('change', function() {
      const preview = document.getElementById('contract-preview');
      if (this.files[0]) {
        preview.innerHTML = `üìÑ ${this.files[0].name}`;
      }
    });

    // Submit new contract
    document.getElementById('contractForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData();
      formData.append('clientName', document.getElementById('clientName').value);
      formData.append('clientEmail', document.getElementById('clientEmail').value);
      formData.append('requestType', document.getElementById('requestType').value);
      formData.append('status', document.getElementById('status').value);
      formData.append('contractFile', document.getElementById('contractFile').files[0]);

      const res = await fetch('/.netlify/functions/create-contract', {
        method: 'POST',
        body: formData
      });
      const resultDiv = document.getElementById('result');
      if (res.ok) {
        const data = await res.json();
        resultDiv.innerHTML = `<p style="color:var(--success);">‚úÖ Reference created: <strong>${data.reference}</strong></p>`;
        document.getElementById('contractForm').reset();
        document.getElementById('contract-preview').innerHTML = '';
      } else {
        resultDiv.innerHTML = `<p style="color:var(--error);">‚ùå Error: ${await res.text()}</p>`;
      }
    });
  </script>
  <script src="js/main.js"></script>
</body>
</html>
